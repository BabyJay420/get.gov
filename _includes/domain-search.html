{% comment %}
TODO: Domain search description
{% endcomment %}

<script>
    function checkDomainAvailability() {
        // TODO: have somethign that catches empty string input?
        const baseUrl = "https://getgov-es.app.cloud.gov/api/v1/available/"

        var requested_domain = document.getElementById('domain-input').value

        if (requested_domain === null || requested_domain.length === 0) {
            render_result(`<p>Please enter a domain name of at least 1 character.</p>`)
        }

        console.log("requested domain", requested_domain)
        var searchEndpoint = new URL(requested_domain, baseUrl);

        fetch(searchEndpoint).then(function(reply) {
            console.log("search endpoint: ", searchEndpoint)
            return reply.json()
        }).then(function(response) {
            console.log("available: ", response)
            if (response.available) {
                render_result(`
                <div class="usa-alert usa-alert--success" role="alert">
                    <div class="usa-alert__body">
                        <p class="usa-alert__text">
                        That domain is available!
                            <a class="usa-link" href="{{ '/domains/before/' | url }}">
                                Read about next steps to take before requesting your .gov domain.
                            </a>
                        </p>
                    </div>
                </div>
                `
                )
            } 
            else {
                render_result(`
                <div class="usa-alert usa-alert--error" role="alert">
                    <div class="usa-alert__body">
                        <p class="usa-alert__text">
                        That domain isn't available.
                            <a class="usa-link" href="{{ '/domains/choosing/' | url }}">
                                Read more about choosing your .gov domain.
                            </a>
                        </p>
                    </div>
                </div>
                `
                )
            }
        }).catch(function(err) {
        console.log('parsing failed', err);
        })
    }

    function render_result(content, append = true){
      document.getElementById('domain-available-message').innerHTML = (append == true) ? content : `<div></div>`;
    }
    
</script>

<section class="hero padding-top-5 padding-bottom-5 bg-accent-cool-lighter">
    <div class="grid-container">
        <!-- TODO: replace hero-image class with svg of updated domain search graphic -->
        <div class="domain-search-image padding-top-2 padding-bottom-2">
            <h2>
                Start your .gov domain search
            </h2>
            <h3 class="domain-search-heading
            line-height-heading-3
            margin-top-0 margin-bottom-2
            text-normal"
            >
                See if the .gov domain you want is available. We'll work with you
                to find the best domain for your organization that meets our requirements.
                <br>
                <a href="{{ '/domains/choosing/' | url }}" class="usa-link">
                    Read more about choosing your .gov domain.
                </a>
            </h3>
            <form class="usa-search usa-search--big domain-search">
                <div role="search">
                    <label class="usa-sr-only" for="search-field-en-big">Search</label>
                    <input 
                        class="usa-input usagov-search-autocomplete grid-col-3" 
                        id="domain-input"
                        type="search" 
                        name="query" 
                        autocomplete="off"
                    >
                        <span class="usa-search__submit-text">.gov</span>
                        <button 
                        class="usa-button availability-button" 
                        type="button"
                        onclick="checkDomainAvailability()"
                        onsubmit="return false">
                            Check Availability
                        </button>
                </div>
            </form>
            <div id="domain-available-message"></div>
        </div>
    </div>
</section>